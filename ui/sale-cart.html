<set title="Shopping Cart @ Raw Materials Art Supplies">

<set header_include="amazon-pay.html" />

<include href="header.html" />

<div class="row">
  <div class="col-sm-12">
    <include href="catalog-header.html" />
    <div class="alert alert-warning">
      <p class="lead">
        <strong>Hello!</strong> We are currently only able to ship orders to the United States (including APO/FPO/DPO addresses).
      </p>
      <check if="!@DROPSHIP_ONLY">
        <p class="lead">
          You can avoid shipping charges entirely by picking up your order at our store in downtown Los Angeles.
        </p>
      </check>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          Your cart
          <span class="pull-right badge">{{ count(@items) }}</span>
        </h3>
      </div>
      <form method="POST" action="{{ @BASE }}/cart/update">
        <include href="sale-items.html" />
        <check if="{{ @REQUEST.added }}">
          <input type="hidden" name="added" value="{{ @REQUEST.added }}">
        </check>
      </form>
      <div class="panel-body">
        <form class="row" method="GET" action="/cart/checkout">
          <input type="hidden" name="uuid" value="{{ @sale.uuid }}">

          <check if="{{ @shipping_status == 'closed' }}">
            <p class="lead alert alert-danger">
              The online store is temporarily closed. You can save items to
              your cart, but cannot place orders at this time.
            </p>
          </check>
          <check if="{{ @shipping_status == 'below_minimum' }}">
            <p class="lead alert alert-danger">
              There is a ${{sprintf('%.2f', @SALE_MINIMUM)}}
              minimum on online orders at this time.
            </p>
          </check>
          <check if="{{ @shipping_status == 'immediate' && !@DROPSHIP_ONLY }}">
            <p class="lead alert alert-success">
              These are in stock at the store and eligible for immediate
              shipment or pick-up. We will contact you if any problems
              arise in having your order ready!
            </p>
          </check>
          <check if="{{ @shipping_status == 'stock_limited' && !@DROPSHIP_ONLY }}">
            <p class="lead alert alert-warning">
              Not all of the items in your cart are currently in stock,
              so your order will take additional time to prepare. We will
              email you with an estimated pick-up/shipping date once your
              order has been processed. (Most orders of out of stock items
              are ready in about one week.)
            </p>
          </check>
          <check if="{{ @shipping_status == 'special_order' && !@DROPSHIP_ONLY }}">
            <p class="lead alert alert-info">
              Your order contains special order items that will take extra
              time to prepare. We will email you with an esimated
              pick-up/shipping date once your order has been reviewed. (Most
              special order items are ready in about one week, some can take
              as long as four to six weeks.)
            </p>
          </check>
          <check if="{{ in_array('hazmat', @special_conditions) }}">
            <p class="lead alert alert-warning">
              Your order contains items that are considered hazarous materials,
              additional shipping charges have been applied.
            </p>
          </check>
          <check if="{{ @shipping_rate == 'truck' }}">
            <p class="lead alert alert-danger">
              Your order contains items that will require truck delivery.
              You can submit your order for manual review, and we'll contact
              you with the cost and instructions on how to complete the order.
            </p>
          </check>
          <check if="{{ @shipping_rate == 'unknown' }}">
            <p class="lead alert alert-danger">
              Sorry, our system is unable to calculate the shipping costs
              for your order due to incomplete information in our system. You
              can submit your order for manual review, and we'll contact you
              with the shipping cost and instructions on how to complete the
              order.
            </p>
          </check>

          <div class="form-group">
            <div class="row">
              <div class="col-sm-4">
                <check if="{{ @REQUEST.added }}">
                  <a href="/{{ @REQUEST.added }}"
                     class="btn btn-default btn-lg btn-block">
                    <i class="fa fa-shopping-cart"></i>
                    Return to shopping
                  </a>
                </check>
              </div>
              <check if="@shipping_status != 'below_minimum'">
                <check if="{{ @shipping_status != 'closed' }}">
                  <div class="col-sm-4">
                    <button type="submit" class="btn btn-primary btn-lg btn-block">
                      <i class="fa fa-sign-in"></i>
                      Check out
                    </button>
                  </div>
                </check>
                <check if="{{ @shipping_status != 'closed' && !in_array(@shipping_rate, [ 'truck', 'unknown' ]) }}">
                  <div class="col-sm-4">
                    <div id="AmazonPayButton"></div>
                  </div>
                </check>
              </check>
            </div>
          </div>
        </form>

      </div>
      <div class="panel-footer">
        <p>
          Feel free to <a href="{{ @BASE }}/contact">contact us
          with any questions or concerns</a>.
        </p>
      </div>
    </div>
  </div>

</div>
<script type="text/javascript">
  function showButton() {
    var authRequest;
    OffAmazonPayments.Button("AmazonPayButton", "{{ @AMZ_MERCHANT_ID }}", {
      type:  "PwA",
      color: "Gold",
      size:  "Large",

      authorization: function() {
	loginOptions= {
          scope: "profile payments:widget payments:shipping_address",
	  popup: "true"
	};
	authRequest=
          amazon.Login.authorize(loginOptions,
                                 "https://{{ @HOST }}/cart/checkout"); 
      },

      onError: function(error) {
	alert("The following error occurred: "
	       + error.getErrorCode()
	       + ' - ' + error.getErrorMessage());
      }
    });
  };
</script>

<include href="footer.html" />

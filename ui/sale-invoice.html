<div class="panel panel-default">
  <check if="{{ @sale.status != 'cart' }}">
    <true>
      <div class="panel-heading">
        <h3 class="panel-title">
          Sale {{ sprintf("%07d", @sale.id) }}
        </h3>
        <p>
          <small>
            Created: {{ @sale.created }} /
            Last Modified: {{ @sale.modified }}
          </small>
        </p>
        <p>
          <i class="fa fa-user-o fa-border"></i>
          {{ @sale.name }}
          &lt;{{ @sale.email }}&gt;
        </p>
      </div>
    </true>
    <false>
      <div class="panel-heading">
        <h3 class="panel-title">
          Shopping Cart
        </h3>
      </div>
    </false>
  </check>
  <table class="table table-striped">
    <thead>
      <tr>
        <th></th>
        <th class="text-right">Qty</th>
        <th>Code</th>
        <th>Name</th>
        <th class="text-right">Price</th>
        <th class="text-right">Ext</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th colspan="3">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'}}">
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-refresh"></i> Update Quantities
          </button>
</check>
        </th>
        <th colspan="2" class="text-right">Subtotal:</th>
        <td class="text-right">{{ @amount(@sale.subtotal) }}</td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">
          Shipping &amp; handling:
        </th>
        <td class="text-right">{{ @amount(@sale.shipping) }}</td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">
          Estimated tax to be collected:
        </th>
        <td class="text-right">{{ @amount(@sale.tax) }}</td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">Total:</th>
        <td class="text-right">{{ @amount(@sale.total) }}</td>
      </tr>
      <repeat group="{{ @payments }}" value="{{ @data }}">
      <tr>
        <th colspan="5" class="text-right">
          <check if="{{ @data.method == 'credit' }}">
            Paid by {{ @data.data.cc_brand }}
            ending in {{ @data.data.cc_last4 }}
          </check>
          <check if="{{ @data.method == 'paypal' }}">
            Paid by PayPal
          </check>
          <check if="{{ @data.method == 'bitcoin' }}">
            Paid with Bitcoin
          </check>
          <check if="{{ @data.method == 'gift' }}">
            Paid with Gift Card 
          </check>
          <check if="{{ @data.method == 'other' }}">
            Paid
          </check>
          ({{ @data.processed }}):
        </th>
        <td colspan="5" class="text-right">{{ @amount(@data.amount) }}</td>
      </tr>
      </repeat>
      <check if="{{ @sale.status != 'cart' }}">
        <tr>
          <th colspan="5" class="text-right">Due:</th>
          <td class="text-right">{{ @amount(@sale.total - @sale.paid) }}</td>
        </tr>
      </check>
    </tfoot>
    <tbody>
    <repeat group="{{ @items }}" value="{{ @data }}">
      <tr valign="top">
        <td></td>
<check if="{{ @FEATURE_cart && @sale.status == 'cart'}}">
  <true>
        <td class="text-right">
          <input type="text" style="width: 4em; text-align: right"
                 class="form-control input-sm"
                 name="qty[{{ @data.id }}]" value="{{ @data.quantity }}">
        </td>
  </true>
  <false>
  </false>
        <td class="text-right">{{ @data.quantity }}</td>
</check>
        <td><small>{{ @data.code }}</small></td>
        <td>
          <span>{{ @data.name }}</span>
          <div class="small">{{ @data.detail }}</div>
        </td>
        <td class="text-right">{{ @amount(@data.sale_price) }}</td>
        <td class="text-right">
          {{ @amount(@data.sale_price * @data.quantity) }}
        </td>
      </tr>
    </repeat>
    </tbody>
  </table>
  <div class="panel-footer">
    <div class="row">
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <i class="fa fa-address-card-o"></i>
              Billing Address
            </h3>
          </div>
          <div class="panel-body">
            <check if="{{ @billing_address.id }}">
              <true>
                <div>{{ @billing_address.name }}</div>
                <div>{{ @billing_address.company }}</div>
                <div>{{ @billing_address.phone }}</div>
                <div>{{ @billing_address.address1 }}</div>
                <div>{{ @billing_address.address2 }}</div>
                <div>
                  {{ @billing_address.city }}, {{ @billing_address.state }}
                  {{ @billing_address.zip5 }}{{ @billing_address.zip4 ? "-" . @billing_address.zip4 : "" }}
                </div>
              </true>
              <false>
                Not specified.
              </false>
            </check>
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <i class="fa fa-address-card-o"></i>
              Shipping Address
            </h3>
          </div>
          <div class="panel-body">
            <check if="{{ !@shipping_address.id ||
                          @shipping_address.id == @billing_address.id }}">
              <true>
                <div>
                  Same as billing address.
                </div>
              </true>
              <false>
                <div>{{ @shipping_address.name }}</div>
                <div>{{ @shipping_address.company }}</div>
                <div>{{ @shipping_address.phone }}</div>
                <div>{{ @shipping_address.address1 }}</div>
                <div>{{ @shipping_address.address2 }}</div>
                <div>
                  {{ @shipping_address.city }}, {{ @shipping_address.state }}
                  {{ @shipping_address.zip5 }}{{ @shipping_address.zip4 ? "-" . @shipping_address.zip4 : "" }}
                </div>
              </false>
            </check>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="panel panel-default">
  <check if="{{ @sale.status != 'cart' }}">
    <true>
      <div class="panel-heading">
        <h3 class="panel-title">
          Sale {{ sprintf("%07d", @sale.id) }}
        </h3>
        <p>
          <small>
            Created: {{ @sale.created }} /
            Last Modified: {{ @sale.modified }}
          </small>
        </p>
        <p>
          <i class="fa fa-user-o fa-border"></i>
          {{ @sale.name }}
          &lt;{{ @sale.email }}&gt;
        </p>
      </div>
    </true>
    <false>
      <div class="panel-heading">
        <h3 class="panel-title">
          Shopping Cart
        </h3>
      </div>
      <form method="POST" action="{{ @BASE }}/cart/update">
    </false>
  </check>
  <table class="table table-striped">
    <thead>
      <tr>
        <th></th>
        <th class="text-right">Qty</th>
        <th>Code</th>
        <th>Name</th>
        <th class="text-right">Price</th>
        <th class="text-right">Ext</th>
      </tr>
    </thead>
    <tfoot>
      <tr>
        <th colspan="3">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'}}">
          <button type="submit" class="btn btn-primary">
            <i class="fa fa-refresh"></i> Update Quantities
          </button>
</check>
        </th>
        <th colspan="2" class="text-right">Subtotal:</th>
        <td class="text-right">{{ @amount(@sale.subtotal) }}</td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">
          Shipping &amp; handling:
        </th>
        <td class="text-right">{{ @amount(@sale.shipping) }}</td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">
          Estimated tax to be collected:
        </th>
        <td class="text-right">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'
              && !@sale.tax_calculated }}">
  <true>
          <span class="text-danger">----------</span>
  </true>
  <false>
          {{ @amount(@sale.tax) }}
  </false>
</check>
        </td>
      </tr>
      <tr>
        <th colspan="5" class="text-right">Total:</th>
        <td class="text-right">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'
              && !@sale.tax_calculated }}">
  <true>
          <span class="text-danger">----------</span>
  </true>
  <false>
          {{ @amount(@sale.total) }}
  </false>
</check>
        </td>
      </tr>
      <repeat group="{{ @payments }}" value="{{ @data }}">
      <tr>
        <th colspan="5" class="text-right">
          <check if="{{ @data.method == 'credit' }}">
            Paid by {{ @data.data.cc_brand }}
            ending in {{ @data.data.cc_last4 }}
          </check>
          <check if="{{ @data.method == 'paypal' }}">
            Paid by PayPal
          </check>
          <check if="{{ @data.method == 'bitcoin' }}">
            Paid with Bitcoin
          </check>
          <check if="{{ @data.method == 'gift' }}">
            Paid with Gift Card 
          </check>
          <check if="{{ @data.method == 'other' }}">
            Paid
          </check>
          ({{ @data.processed }}):
        </th>
        <td colspan="5" class="text-right">{{ @amount(@data.amount) }}</td>
      </tr>
      </repeat>
      <check if="{{ @sale.status != 'cart' }}">
        <tr>
          <th colspan="5" class="text-right">Due:</th>
          <td class="text-right">{{ @amount(@sale.total - @sale.paid) }}</td>
        </tr>
      </check>
    </tfoot>
    <tbody>
    <repeat group="{{ @items }}" value="{{ @data }}">
      <tr valign="top">
        <td></td>
<check if="{{ @FEATURE_cart && @sale.status == 'cart'}}">
  <true>
        <td class="text-right">
          <input type="text" style="width: 4em; text-align: right"
                 class="form-control input-sm"
                 name="qty[{{ @data.id }}]" value="{{ @data.quantity }}">
        </td>
  </true>
  <false>
  </false>
        <td class="text-right">{{ @data.quantity }}</td>
</check>
        <td><small>{{ @data.code }}</small></td>
        <td>
          <span>{{ @data.name }}</span>
          <div class="small">{{ @data.detail }}</div>
        </td>
        <td class="text-right">{{ @amount(@data.sale_price) }}</td>
        <td class="text-right">
          {{ @amount(@data.sale_price * @data.quantity) }}
        </td>
      </tr>
    </repeat>
    </tbody>
  </table>
<check if="{{ @FEATURE_cart && @sale.status == 'cart'}}">
  </form>
</check>
  <div class="panel-footer">
    <div class="row">
      <div class="col-sm-8">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <i class="fa fa-address-card-o"></i>
              Billing Address
            </h3>
          </div>
          <div class="panel-body">
<check if="{{ @FEATURE_cart && @sale.status == 'cart' }}">
  <true>
      <form method="POST" action="{{ @BASE }}/cart/set-address">
        <div class="row">
          <div class="form-group col-sm-12">
            <label for="name">Name</label>
            <input type="text" class="form-control" name="name"
                   value="{{ @billing_address.name }}">
          </div>

          <div class="form-group col-sm-12">
            <label for="company">Company (optional)</label>
            <input type="text" class="form-control" name="company"
                   value="{{ @billing_address.company }}">
          </div>

          <div class="form-group col-sm-12">
            <label for="phone">Phone (optional)</label>
            <input type="text" class="form-control" name="phone"
                   value="{{ @billing_address.phone }}">
          </div>

          <div class="form-group col-sm-12">
            <label for="address1">Address</label>
            <input type="text" class="form-control" name="address1"
                   value="{{ @billing_address.address1 }}"
                   placeholder="436 S Main St">
            <input type="text" class="form-control" name="address2" 
                   value="{{ @billing_address.address2 }}"
                   placeholder="Apt 2-B">
          </div>
          <div class="form-group col-sm-5">
            <label for="city">City</label>
            <input type="text" class="form-control" name="city"
                   value="{{ @billing_address.city }}"
                   placeholder="Los Angeles">
          </div>
          <div class="form-group col-sm-2">
            <label for="state">State</label>
            <input type="text" class="form-control" name="state"
                   value="{{ @billing_address.state }}"
                   placeholder="CA">
          </div>
          <div class="form-group col-sm-3">
            <label for="zip">ZIP</label>
            <input type="text" class="form-control" name="zip5"
                   value="{{ @billing_address.zip5 }}"
                   placeholder="90013">
          </div>
          <div class="form-group col-sm-2">
            <label for="zip4">+4</label>
            <input type="text" class="form-control" name="zip4"
                   value="{{ @billing_address.zip4 }}"
                   placeholder="0000">
          </div>
        </div>

        <button type="submit" class="btn btn-primary">
          <i class="fa fa-home"></i> Set Address
        </button>
      </form>
  </true>
  <false>
            <check if="{{ @billing_address.id }}">
              <true>
                <div>{{ @billing_address.name }}</div>
                <div>{{ @billing_address.company }}</div>
                <div>{{ @billing_address.phone }}</div>
                <div>{{ @billing_address.address1 }}</div>
                <div>{{ @billing_address.address2 }}</div>
                <div>
                  {{ @billing_address.city }}, {{ @billing_address.state }}
                  {{ @billing_address.zip5 }}{{ @billing_address.zip4 ? "-" . @billing_address.zip4 : "" }}
                </div>
              </true>
              <false>
                Not specified.
              </false>
            </check>
  </false>
</check>
          </div>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">
              <i class="fa fa-address-card-o"></i>
              Shipping Address
            </h3>
          </div>
          <div class="panel-body">
            <check if="{{ !@shipping_address.id ||
                          @shipping_address.id == @billing_address.id }}">
              <true>
                <div>
                  Same as billing address.
<check if="{{ @FEATURE_cart && @sale.status == 'cart' }}">
                  <p class="text-info">
                    (If this should be different, please note the shipping
                    address in the comments when submitting your order. This
                    may cause the sales tax to be collected to change.)
                  </p>
                  <form method="POST"
                        action="{{ @BASE }}/cart/set-in-store-pickup">
                    <button type="submit" class="btn btn-default">
                      <i class="fa fa-building"></i> Pick up at our store
                    </button>
                  </form>
</check>
                </div>
              </true>
              <false>
                <div>{{ @shipping_address.name }}</div>
                <div>{{ @shipping_address.company }}</div>
                <div>{{ @shipping_address.phone }}</div>
                <div>{{ @shipping_address.address1 }}</div>
                <div>{{ @shipping_address.address2 }}</div>
                <div>
                  {{ @shipping_address.city }}, {{ @shipping_address.state }}
                  {{ @shipping_address.zip5 }}{{ @shipping_address.zip4 ? "-" . @shipping_address.zip4 : "" }}
                </div>
              </false>
            </check>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

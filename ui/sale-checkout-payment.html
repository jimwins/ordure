<script>
gtag('event', 'checkout_progress', {
  "items": [
<repeat group="{{ @items }}" value="{{ @item }}" counter="{{ @index }}">
<check if="{{ @index > 1 }}">,</check>
{
  'id': "p{{ @item.product_id }}",
  'name': "{{ @item.product_name }}",
  'brand': "{{ @item.brand_name }}",
  'variant': "{{ @item.code }}",
  'quantity': "{{ @item.quantity }}",
  'price': "{{ @item.sale_price }}",
}
</repeat>
  ]
});
</script>
<check if="{{ @sale.shipping_address_id == 1 }}">
  <check if="{{ @shipping_status == 'special_order' }}">
    <div class="alert alert-danger">
      We will contact you via email to give you an estimated date when
      your special order item(s) will be ready for pickup.
    </div>
  </check>

  <check if="{{ @shipping_status == 'stock_limited' }}">
    <div class="alert alert-danger">
      We will contact you via email to give you an estimated date when
      your out of stock item(s) will be ready for pickup.
    </div>
  </check>
</check>

<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="pay-credit-card-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse"
           data-parent="#accordion" href="#pay-credit-card"
           aria-expanded="true" area-controls="pay-credit-card">
          <i class="fa fa-credit-card fa-lg"></i>
          Pay with Credit Card
        </a>
      </h4>
    </div>
    <div id="pay-credit-card" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="pay-credit-card-heading">
      <div class="panel-body">
        <form method="POST"
              action="/sale/{{ @sale.uuid }}/process-creditcard-payment"
              data-ajax="1"
              id="payment-form">
          <noscript>
            <p class="alert alert-danger">
              Sorry, you must have Javascript enabled in order to pay
              online.
            </p>
          </noscript>
          <div class="form-group">
            <label>
              <span>Amount to be paid</span>
              <input type="text" class="form-control" disabled
                     value="{{ @amount(@sale.total - @sale.paid) }}">
            </label>
          </div>
          <div class="form-group">
            <label>
              <span>Card number</span>
            </label>
            <div id="card-element" class="form-control"></div>
          </div>

          <div class="form-group">
            <label for="comment">Any special requests?</label>
            <textarea class="form-control" rows="6" name="comment"></textarea>
          </div>

          <div id="card-errors" class="alert alert-danger hidden" role="alert">
          </div>
          <button class="btn btn-primary">
            Pay {{ @amount(@sale.total - @sale.paid) }}
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="pay-paypal-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse"
           data-parent="#accordion" href="#pay-paypal"
           aria-expanded="true" area-controls="pay-paypal">
          <i class="fa fa-paypal fa-lg"></i>
          Pay with PayPal
        </a>
      </h4>
    </div>
    <div id="pay-paypal" class="panel-collapse collapse" role="tabpanel" aria-labelledby="pay-paypal-heading">
      <div class="panel-body">
        <div class="paypal-prompt">
          <form id="paypal-form">
            <div class="paypal-errors alert alert-danger hidden"></div>
            <div class="form-group">
              <label>
                <span>Amount to be paid</span>
                <input type="text" class="form-control" disabled
                       value="{{ @amount(@sale.total - @sale.paid) }}">
              </label>
            </div>

            <div class="form-group">
              <label for="comment">Any special requests?</label>
              <textarea class="form-control" rows="6" name="comment"></textarea>
            </div>

            <div id="paypal-button"></div>
          </form>
        </div>
        <div class="paypal-waiting hidden">
          <div class="progress progress-striped active"
               style="height: 1.5em">
            <div class="progress-bar" role="progressbar"
                 aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"
                 style="width: 100%">
              Processing PayPal payment&hellip;.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="pay-giftcard-heading">
      <h4 class="panel-title">
        <a role="button" data-toggle="collapse"
           data-parent="#accordion" href="#pay-giftcard"
           aria-expanded="true" area-controls="pay-giftcard">
          <i class="fa fa-gift fa-lg"></i>
          Pay with Gift Card
        </a>
      </h4>
    </div>
    <div id="pay-giftcard" class="panel-collapse collapse" role="tabpanel" aria-labelledby="pay-giftcard-heading">
      <div class="panel-body">
        <form id="giftcard-check"
              action="/sale/{{ @sale.uuid }}/get-giftcard-balance">
          <div class="errors alert alert-danger hidden"></div>
          <div class="form-group">
            <label for="giftcard">Gift Card Number</label>
            <input type="text" class="form-control" name="giftcard"
                   placeholder="Enter the 11-digit code.">
          </div>
          <button type="submit" class="btn btn-primary">
            Check Balance
          </button>
        </form>
        <form id="giftcard-use"
              action="/sale/{{ @sale.uuid }}/process-giftcard-payment"
              class="hidden">
          <div class="errors alert alert-danger hidden"></div>
          <div class="form-group">
            <label>
              <span>Gift card balance</span>
              <input type="text" class="form-control" disabled
                     name="balance" value="0">
            </label>
          </div>

          <div class="form-group">
            <label for="comment">Any special requests?</label>
            <textarea class="form-control" rows="6" name="comment"></textarea>
          </div>

          <input type="hidden" name="amount" value="{{ @sale.total - @sale.paid }}">
          <button type="submit" class="btn btn-primary">
            Pay
          </button>
        </form>
      </div>
    </div>
  </div>

</div><!-- /.panel-group -->

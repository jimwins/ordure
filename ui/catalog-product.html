<include href="header.html" />
<include href="catalog-header.html" />
<div class="row">
  <div class="col-sm-9 col-sm-push-3">
    <ol class="breadcrumb">
      <li><a href="{{ @BASE . '/' . @CATALOG }}">Art Supplies</a></li>
      <li><a href="{{ @BASE . '/' . @CATALOG . '/' . @dept.slug }}">{{ @dept.name }}</a></li>
      <li><a href="{{ @BASE . '/' . @CATALOG . '/' . @dept.slug . '/' . @subdept.slug }}">{{ @subdept.name }}</a></li>
      <li class="active">{{ @product.name }}</li>
    </ol>

    <include href="searchform.html" />

    <div class="page-header" data-product="{{ @product.id }}">
      <h1>
        {{ @product.name }}
        <small>{{ @product.brand_name }}</small>
      </h1>
    </div>

    <div class="row">
      <div class="col-sm-6">
        {{ @markdown(@product.description) | raw }}
      </div>

      <div class="col-sm-6">
<style type="text/css">
  .carousel {
    position: relative;
    width: 100%;
  }
  .carousel:before {
    content: "";
    display: block;
    padding-top: 100%;
  }
  .carousel ol {
    margin: 0;
    padding: 0;

    display: block;
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
  }
  .carousel li {
    margin: 0; padding: 0;

    list-style: none;
    z-index: 2;

    display: block;
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;

    opacity: 0;
    transition: 1s;
  }
  .carousel li img {
    width: 100%;
    height: 100%;
    object-fit: scale-down;
  }
  .carousel li.current, .carousel:not(.active) li:first-child {
    opacity: 1;
    transition: 1s;
  }
  .carousel button {
    visibility: hidden;
  }
  .carousel.active button {
    visibility: visible;
  }
  .carousel.active .buttons {
    text-align: center;
    z-index: 10;
    position: absolute;
    bottom: 0;
    width: 100%;
    padding-bottom: 1em;
  }
</style>

<figure class="thumbnail carousel">
  <ol class="carousel-content">
    <repeat group="{{ @product.media }}" value="{{ @image }}" counter="{{ @index }}">
      <li>
        <img src="{{ @image.src ? @STATIC . @image.src : @MEDIA . '/file/c_fit,w_768,h_768/' . @image.uuid . '.jpg' }}" alt="{{ @image.alt_text }}">
        <!--
        <check if="{{ ! @NO_PINTEREST }}">
          <div class="caption text-center">
            <a href="//www.pinterest.com/pin/create/button/?url={{ urlencode('https://' . $_SERVER['HTTP_HOST'] . @URI) }}&media={{ urlencode('https:' . @STATIC . (@image.src ?: ('/i/st/' . @image.uuid . '.jpg'))) }}&description={{ urlencode(@product.name) }}" data-pin-do="buttonPin" data-pin-config="beside" data-pin-color="white"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_white_20.png" /></a>
          </div>
        </check>
        -->
      </li>
    </repeat>
  </ol>
  <div class="buttons">
    <button class="prev btn btn-default btn-xs">
       ◀ <span class="sr-only">Previous</span>
    </button>
    <button class="next btn btn-default btn-xs">
      <span class="sr-only">Next</span> ▶
    </button>
  </div>
  <script>
    let box= document.currentScript.parentNode

    let next= box.querySelector('.next')
    let prev= box.querySelector('.prev')
    // Define the global counter, the items and the current item
    let counter= 0
    let items= box.querySelectorAll('.carousel-content li')
    let amount= items.length
    // If we only have one slide, don't bother showing controls
    if (amount > 1) {
      box.classList.add('active')

      // navigate through the carousel
      let navigate= (direction= 1) => {
        // hide the current slide
        items[counter].classList.remove('current')

        // calculate the new position
        counter= (counter + direction) % amount
        counter= counter < 0 ? amount - 1 : counter

        // show the new slide
        items[counter].classList.add('current')
      }

      let interval= setInterval(navigate, 5000)

      // add event handlers to box to pause/resume
      box.addEventListener('mouseenter', (ev) => {
        clearInterval(interval)
      })
      box.addEventListener('mouseleave', (ev) => {
        interval= setInterval(navigate, 5000)
      })

      // add event handlers to buttons
      next.addEventListener('click', (ev) => {
        navigate(1)
      })
      prev.addEventListener('click', (ev) => {
        navigate(-1)
      })
      // show the first element
      navigate(0)
    }
  </script>
</figure>
      </div>
    </div>

    <script>
gtag('event', 'view_item', {
  "items": [
    {
      'id': "p{{ @product.id }}",
      'name': "{{ @product.name }}",
      'brand': "{{ @product.brand_name }}"
    }
  ]
});
    </script>

    <check if="!(@CAN_SHIP || @CAN_PICKUP) && @CAN_DROPSHIP">
      <div class="alert alert-warning">
        <strong>Availability alert!</strong>  Items that say "Maybe" may
        not be in stock, this only indicates that the item is usually stocked
        in the warehouse. Your payment will be refunded for any items we are
        unable to have shipped.
      </div>
    </check>

    <check if="{{ count(@variations) > 1 &&
               @product.variation_style == 'tabs' }}">
      <ul class="nav nav-tabs">
        <repeat group="{{ @variations }}"
                key="{{ @variation }}"
                value="{{ @num }}"
                counter="{{ @ctr }}">
          <li class="{{ @ctr == 1 ? 'active' : '' }}">
            <a href="#v{{ @ctr }}" data-toggle="tab">{{ @variation }}</a>
          </li>
        </repeat>
      </ul>
    </check>

    <div class="{{ @product.variation_style == 'tabs' ? 'tab-content' : '' }}">
      <repeat group="{{ @variations }}"
              key="{{ @variation }}"
              value="{{ @num }}"
              counter="{{ @ctr }}">
        <check if="{{ @product.variation_style == 'flat' }}">
          <h4>{{ @variation }}</h4>
        </check>
        <div class="tab-pane {{ @ctr == 1 ? 'active' : '' }}"
             id="v{{ @ctr }}">
          <table class="table table-condensed table-striped">
            <thead>
              <tr>
                <th class="col-xs-2">Item No.</th>
                <th class="col-xs-3">Description</th>
                <th class="col-xs-1">List</th>
                <th class="col-xs-1">Sale</th>
                <th class="col-xs-2 text-center" data-toggle="tooltip" data-container="body" data-placement="top" title="Whether this item is in available for pick up, shipping, special order, or drop-ship.">Availability</th>
                <th class="col-xs-2 text-center" data-toggle="tooltip" data-container="body" data-placement="top" title="Whether this item is in stock at the store.">In Stock</th>
                <check if="{{ @FEATURE_cart && @CAN_ORDER }}">
                  <th class="col-xs-1"></th>
                </check>
              </tr>
            </thead>
            <tbody>
              <repeat group="{{ @items }}" value="{{ @item }}">
                <check if="{{ htmlspecialchars(@variation) == @item.variation }}">
                  <tr data-item="{{ @item.id }}">
                    <td nowrap>
                      <check if="@item.description || @item.media">
                        <true>
                          <a href="{{ @product.slug . '/' . urlencode(@item.code) }}">{{ @item.code }}</a>
                        </true>
                        <false>
                          {{ @item.code }}
                        </false>
                      </check>
                    </td>
                    <td style="{{ @item_style_color(@item.thumbnail) }}">
                      {{ strlen(@item.short_name) ? @item.short_name : @item.name }}
                    </td>
                    <td>
                      {{ Catalog::amount(@item.retail_price * max(@item.purchase_quantity,1)) }}
                      <check if="{{ @item.purchase_quantity > 1 }}">
                        <br><small>({{ @item.purchase_quantity }} pieces)</small>
                      </check>
                    </td>
                    <td class="text-primary">
                      <strong>
                        {{ @item.sale_price ? Catalog::amount(@item.sale_price * max(@item.purchase_quantity,1)) : '' }}
                      </strong>
                    </td>
                    <td class="text-center">
                      <small>
                        <check if="@CAN_SHIP">
                          <true>
                            <check if="@item.is_dropshippable">
                              <true>
                                Shipped from store or drop-shipped
                              </true>
                              <false>
                                Shipped from store
                              </false>
                            </check>
                          </true>
                          <false>
                            <check if="@item.is_dropshippable">
                              <true>
                                Drop-ship only
                              </true>
                              <false>
                                Special order
                              </false>
                            </check>
                          </false>
                        </check>
                      </small>
                    </td>
                    <td class="text-center">
                      <check if="(@CAN_SHIP || @CAN_PICKUP) && (@item.minimum_quantity || @item.stocked)">
                        <true>
                          <check if="@item.stocked > 0">
                            <true>
                             <small class="text-success">In stock</small>
                            </true>
                            <false>
                             <small class="text-danger">Out of stock</small>
                            </false>
                          </check>
                        </true>
                        <false>
                          <check if="@CAN_DROPSHIP && @item.is_dropshippable">
                            <true>
                              <small class="text-warning" data-toggle="tooltip" title="Sorry, we don't have live stock information for items that are drop-shipped.">Maybe</small>
                            </true>
                            <false>
                              <small>Special order</small>
                            </false>
                          </check>
                        </false>
                      </check>
                      <check if="@item.prop65">
                        <a class="pull-right" href="/proposition-65-warning" data-toggle="tooltip" title="WARNING: This product can expose you to chemicals which are known to the state of California to cause cancer and/or to cause birth defects or other reproductive harm. Click for more details."><img src="{{ @STATIC }}/msds/warning.svg" width="20" alt="WARNING"></a>
                      </check>
                      <check if="@item.hazmat">
                        <a class="pull-right" href="/shipping#hazmat" data-toggle="tooltip" title="Hazardous materials: special shipping is required, and there may be additional costs. Click for more details."><img src="{{ @STATIC }}/msds/dot-limited-quantity-surface.svg" width="20" alt="Hazardous Materials"></a>
                      </check>
                      <check if="@item.oversized">
                        <a class="pull-right" href="/shipping#oversized" data-toggle="tooltip" title="Oversized item: special shipping is required, and there will be additional costs. Click for more details."><i class="fa fa-truck"></i></a>
                      </check>
                    </td>
                    <check if="@FEATURE_cart && @CAN_ORDER && (((@CAN_PICKUP || @CAN_SHIP) && @item.stocked) || (@CAN_DROPSHIP && @item.is_dropshippable)) ">
                      <true>
                        <td>
                          <form class="form-inline" onsubmit="gtag('event', 'add_to_cart', { 'items': [ { 'id': 'P{{@product.id}}', 'name': '{{@product.name}}', 'brand': '{{@product.brand_name}}', 'variant': '{{@item.code}}', 'quantity': '{{@item.purchase_quantity}}', 'price': '{{@item.sale_price}}' } ] })"
                                action="/cart/add-item" method="POST">
                            <input type="hidden"
                                   name="item" value="{{ @item.code }}">
                            <button type="submit" class="btn btn-primary btn-xs">
                              <i class="fa fa-plus-square"></i> Add to Cart
                            </button>
                          </form>
                        </td>
                      </true>
                      <false>
                        <td></td>
                      </false>
                    </check>
                  </tr>
                </check>
              </repeat>
            </tbody>
          </table>
        </div>
      </repeat>
    </div>
  </div>
  <div class="col-sm-3 col-sm-pull-9">
    <include href="catalog-sidebar.html" />
  </div>
</div>
<include href="footer.html" />
<check if="{{ @featured_item }}">
  <div class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <a href="{{ @BASE . '/' . @CATALOG . '/' . @dept.slug . '/' . @subdept.slug . '/' . @product.slug }}" class="close" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </a>
          <h4 class="modal-title">{{ @featured_item.name }}</h4>
        </div>
        <div class="modal-body">
          <div class="pull-right col-sm-4">
            <figure class="thumbnail carousel">
              <ol class="carousel-content">
                <repeat group="{{ @featured_item.media }}" value="{{ @image }}" counter="{{ @index }}">
                  <li>
                    <img src="{{ @image.src ? @STATIC . @image.src : @MEDIA . '/file/c_fit,w_768,h_768/' . @image.uuid . '.jpg' }}" alt="{{ @image.alt_text }}">
                    <!--
                    <check if="{{ ! @NO_PINTEREST }}">
                      <div class="caption text-center">
                        <a href="//www.pinterest.com/pin/create/button/?url={{ urlencode('https://' . $_SERVER['HTTP_HOST'] . @URI) }}&media={{ urlencode('https:' . @STATIC . (@image.src ?: ('/i/st/' . @image.uuid . '.jpg'))) }}&description={{ urlencode(@featured_item.name) }}" data-pin-do="buttonPin" data-pin-config="beside" data-pin-color="white"><img src="//assets.pinterest.com/images/pidgets/pinit_fg_en_rect_white_20.png" /></a>
                      </div>
                    </check>
                    -->
                  </li>
                </repeat>
              </ol>
              <div class="buttons">
                <button class="prev btn btn-default btn-xs">
                   ◀ <span class="sr-only">Previous</span>
                </button>
                <button class="next btn btn-default btn-xs">
                  <span class="sr-only">Next</span> ▶
                </button>
              </div>
              <script>
              {
                let box= document.currentScript.parentNode

                let next= box.querySelector('.next')
                let prev= box.querySelector('.prev')
                // Define the global counter, the items and the current item
                let counter= 0
                let items= box.querySelectorAll('.carousel-content li')
                let amount= items.length
                // If we only have one slide, don't bother showing controls
                if (amount > 1) {
                  box.classList.add('active')

                  // navigate through the carousel
                  let navigate= (direction= 1) => {
                    // hide the current slide
                    items[counter].classList.remove('current')

                    // calculate the new position
                    counter= (counter + direction) % amount
                    counter= counter < 0 ? amount - 1 : counter

                    // show the new slide
                    items[counter].classList.add('current')
                  }

                  let interval= setInterval(navigate, 5000)

                  // add event handlers to box to pause/resume
                  box.addEventListener('mouseenter', (ev) => {
                    clearInterval(interval)
                  })
                  box.addEventListener('mouseleave', (ev) => {
                    interval= setInterval(navigate, 5000)
                  })

                  // add event handlers to buttons
                  next.addEventListener('click', (ev) => {
                    navigate(1)
                  })
                  prev.addEventListener('click', (ev) => {
                    navigate(-1)
                  })
                  // show the first element
                  navigate(0)
                }
              }
              </script>
            </figure>
          </div>
          <div class="col-sm-8">
            <check if="@featured_item.description">
              {{ @markdown(@featured_item.description) | raw }}
            </check>
            <check if="@featured_item.short_name">
              <div class="input-group">
                <label>
                  Short Name
                </label>
                <p class="form-control-static">
                  {{ @featured_item.short_name }}
                </p>
              </div>
            </check>
            <check if="@featured_item.variation">
              <div class="input-group">
                <label>
                  Variation
                </label>
                <p class="form-control-static">
                  {{ @featured_item.variation }}
                </p>
              </div>
            </check>
            <div class="input-group">
              <label>
                List Price
              </label>
              <p class="form-control-static">
                {{ Catalog::amount(@featured_item.retail_price * max(@featured_item.purchase_quantity,1)) }}
                <check if="{{ @featured_item.purchase_quantity > 1 }}">
                  <br><small>({{ @featured_item.purchase_quantity }} pieces)</small>
                </check>
              </p>
            </div>

            <check if="@featured_item.sale_price != @featured_item.retail_price">
              <div class="input-group">
                <label>
                  Sale Price
                </label>
                <p class="form-control-static">
                  {{ @featured_item.sale_price ? Catalog::amount(@featured_item.sale_price * max(@featured_item.purchase_quantity,1)) : '' }}
                </p>
              </div>
            </check>

            <check if="@FEATURE_cart && @CAN_ORDER && (((@CAN_PICKUP || @CAN_SHIP) && @featured_item.stocked) || (@CAN_DROPSHIP && @featured_item.is_dropshippable)) ">
              <form class="form-inline" onsubmit="gtag('event', 'add_to_cart', { 'featured_items': [ { 'id': 'P{{@product.id}}', 'name': '{{@product.name}}', 'brand': '{{@product.brand_name}}', 'variant': '{{@featured_item.code}}', 'quantity': '{{@featured_item.purchase_quantity}}', 'price': '{{@featured_item.sale_price}}' } ] })"
                    action="/cart/add-featured_item" method="POST">
                <input type="hidden"
                       name="featured_item" value="{{ @featured_item.code }}">
                <div class="input-group">
                  <span class="input-group-addon" id="quantity-addon1">Quantity</span>
                  <input type="text" class="form-control" name="quantity"
                         value="{{ @featured_item.purchase_quantity }}">
                  <div class="input-group-btn">
                    <button type="submit" class="btn btn-primary">
                      <i class="fa fa-plus-square"></i> Add to Cart
                    </button>
                  </div>
                </div>
              </form>
            </check>

          </div>
          <div class="clearfix"></div>
        </div>
        <div class="modal-footer">
          <a href="{{ @BASE . '/' . @CATALOG . '/' . @dept.slug . '/' . @subdept.slug . '/' . @product.slug }}" class="btn btn-default">
            Close
          </a>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->  
  <script>
    afterLoad(function() {
      $('.modal').modal('show');
    });
  </script>
</check>
<check if="{{ ! @NO_PINTEREST }}">
<script type="text/javascript">
(function(d){
    var f = d.getElementsByTagName('SCRIPT')[0], p = d.createElement('SCRIPT');
    p.type = 'text/javascript';
    p.async = true;
    p.src = '//assets.pinterest.com/js/pinit.js';
    f.parentNode.insertBefore(p, f);
}(document));
</script>
</check>

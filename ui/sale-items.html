<table class="table table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Quantity</th>
      <th>Code</th>
      <th>Name</th>
      <th class="text-right">Price</th>
      <th class="text-right">Ext</th>
    </tr>
  </thead>
  <tbody>
  <repeat group="{{ @items }}" value="{{ @data }}">
    <tr valign="top">
      <td></td>
<check if="{{ @FEATURE_cart && @sale.status == 'cart' && !@stage}}">
  <true>
      <td>
        <input type="text" style="width: 4em; text-align: right"
               class="form-control input-sm"
               name="qty[{{ @data.id }}]" value="{{ @data.quantity }}">
      </td>
  </true>
  <false>
      <td>{{ @data.quantity }}</td>
  </false>
</check>
      <td><small>{{ @data.code }}</small></td>
      <td>
        <span>{{ @data.name }}</span>
        <div class="small">{{ @data.detail }}</div>
      </td>
      <td class="text-right">{{ @amount(@data.sale_price) }}</td>
      <td class="text-right">
        {{ @amount(@data.sale_price * @data.quantity) }}
      </td>
    </tr>
  </repeat>
  </tbody>
  <tfoot>
    <tr>
      <th colspan="3">
<check if="{{ @FEATURE_cart && @sale.status == 'cart' && !@stage}}">
        <button type="submit" class="btn btn-default btn-sm">
          <i class="fa fa-refresh"></i> Update Quantities
        </button>
</check>
      </th>
      <th colspan="2" class="text-right">Subtotal:</th>
      <td class="text-right">{{ @amount(@sale.subtotal) }}</td>
    </tr>
    <tr>
      <th colspan="5" class="text-right">
        Shipping &amp; handling:
      </th>
      <td class="text-right">{{ @amount(@sale.shipping) }}</td>
    </tr>
    <tr>
      <th colspan="5" class="text-right">
<check if="{{ in_array(@sale.status, [ 'cart', 'unpaid', 'review' ]) }}">
  <true>
        Estimated tax:
  </true>
  <false>
        Tax:
  </false>
</check>
      </th>
      <td class="text-right">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'
            && !@sale.tax_calculated }}">
  <true>
        <span class="text-danger">TBD</span>
  </true>
  <false>
        {{ @amount(@sale.tax) }}
  </false>
</check>
      </td>
    </tr>
    <tr>
      <th colspan="5" class="text-right">Total:</th>
      <td class="text-right">
<check if="{{ @FEATURE_cart && @sale.status == 'cart'
            && !@sale.tax_calculated }}">
  <true>
        <span class="text-danger">TBD</span>
  </true>
  <false>
        {{ @amount(@sale.total) }}
  </false>
</check>
      </td>
    </tr>
    <repeat group="{{ @payments }}" value="{{ @data }}">
      <tr>
        <th colspan="5" class="text-right">
          <check if="{{ @data.method == 'credit' }}">
            Paid by {{ @data.data.cc_brand }}
            ending in {{ @data.data.cc_last4 }}
          </check>
          <check if="{{ @data.method == 'paypal' }}">
            Paid by PayPal
          </check>
          <check if="{{ @data.method == 'bitcoin' }}">
            Paid with Bitcoin
          </check>
          <check if="{{ @data.method == 'gift' }}">
            Paid with Gift Card 
          </check>
          <check if="{{ @data.method == 'other' }}">
            Paid
          </check>
          ({{ @data.processed }}):
        </th>
        <td colspan="5" class="text-right">{{ @amount(@data.amount) }}</td>
      </tr>
    </repeat>
    <check if="{{ @sale.status != 'cart' }}">
      <tr>
        <th colspan="5" class="text-right">Due:</th>
        <td class="text-right">{{ @amount(@sale.total - @sale.paid) }}</td>
      </tr>
    </check>
  </tfoot>
</table>
